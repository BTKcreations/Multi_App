<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Palette Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .color-swatch {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .color-swatch:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        .palette-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .dark .palette-card {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
        }
        .drag-area {
            border: 2px dashed #cbd5e0;
            transition: all 0.3s ease;
        }
        .drag-area:hover, .drag-area.dragover {
            border-color: #4299e1;
            background-color: rgba(66, 153, 225, 0.1);
        }
        .color-wheel {
            background: conic-gradient(
                red, orange, yellow, lime, cyan, blue, magenta, red
            );
            border-radius: 50%;
        }
        .harmony-preview {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <div class="min-h-screen p-4">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <header class="text-center mb-8">
                <h1 class="text-4xl font-bold bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent">
                    Color Palette Generator
                </h1>
                <p class="text-gray-600 dark:text-gray-400 mt-2">Create harmonious color schemes for your projects</p>
            </header>

            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Controls Panel -->
                <div class="lg:col-span-1 space-y-6">
                    <!-- Color Input Methods -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Generate From</h3>
                        
                        <!-- Color Picker -->
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Base Color</label>
                                <div class="flex items-center space-x-3">
                                    <input id="baseColorPicker" type="color" value="#3b82f6" 
                                           class="w-12 h-12 border-2 border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer">
                                    <input id="baseColorHex" type="text" value="#3b82f6" 
                                           class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 font-mono text-sm">
                                </div>
                            </div>
                            
                            <!-- Color Harmony Type -->
                            <div>
                                <label class="block text-sm font-medium mb-2">Color Harmony</label>
                                <select id="harmonyType" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700">
                                    <option value="complementary">Complementary</option>
                                    <option value="triadic">Triadic</option>
                                    <option value="analogous">Analogous</option>
                                    <option value="tetradic">Tetradic</option>
                                    <option value="monochromatic">Monochromatic</option>
                                    <option value="split-complementary">Split Complementary</option>
                                </select>
                            </div>
                            
                            <button onclick="generateFromColor()" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                Generate Palette
                            </button>
                        </div>
                    </div>

                    <!-- Image Upload -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Extract from Image</h3>
                        <div id="imageDropArea" class="drag-area p-8 text-center rounded-lg">
                            <svg class="w-12 h-12 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Drop image here or click to upload</p>
                            <input id="imageInput" type="file" accept="image/*" class="hidden">
                            <button onclick="document.getElementById('imageInput').click()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm">
                                Choose File
                            </button>
                        </div>
                        <canvas id="imageCanvas" class="hidden"></canvas>
                    </div>

                    <!-- Preset Palettes -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Trending Palettes</h3>
                        <div class="space-y-3">
                            <div onclick="loadPresetPalette('sunset')" class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded">
                                <div class="flex">
                                    <div class="w-6 h-6 rounded-l" style="background-color: #ff6b6b;"></div>
                                    <div class="w-6 h-6" style="background-color: #ffa726;"></div>
                                    <div class="w-6 h-6" style="background-color: #ffcc02;"></div>
                                    <div class="w-6 h-6" style="background-color: #ff8a65;"></div>
                                    <div class="w-6 h-6 rounded-r" style="background-color: #d84315;"></div>
                                </div>
                                <span class="text-sm">Sunset</span>
                            </div>
                            <div onclick="loadPresetPalette('ocean')" class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded">
                                <div class="flex">
                                    <div class="w-6 h-6 rounded-l" style="background-color: #0077be;"></div>
                                    <div class="w-6 h-6" style="background-color: #00a8cc;"></div>
                                    <div class="w-6 h-6" style="background-color: #40e0d0;"></div>
                                    <div class="w-6 h-6" style="background-color: #87ceeb;"></div>
                                    <div class="w-6 h-6 rounded-r" style="background-color: #b0e0e6;"></div>
                                </div>
                                <span class="text-sm">Ocean</span>
                            </div>
                            <div onclick="loadPresetPalette('forest')" class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded">
                                <div class="flex">
                                    <div class="w-6 h-6 rounded-l" style="background-color: #2d5016;"></div>
                                    <div class="w-6 h-6" style="background-color: #228b22;"></div>
                                    <div class="w-6 h-6" style="background-color: #90ee90;"></div>
                                    <div class="w-6 h-6" style="background-color: #9acd32;"></div>
                                    <div class="w-6 h-6 rounded-r" style="background-color: #adff2f;"></div>
                                </div>
                                <span class="text-sm">Forest</span>
                            </div>
                            <div onclick="loadPresetPalette('vintage')" class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded">
                                <div class="flex">
                                    <div class="w-6 h-6 rounded-l" style="background-color: #8b4513;"></div>
                                    <div class="w-6 h-6" style="background-color: #d2691e;"></div>
                                    <div class="w-6 h-6" style="background-color: #daa520;"></div>
                                    <div class="w-6 h-6" style="background-color: #cd853f;"></div>
                                    <div class="w-6 h-6 rounded-r" style="background-color: #f4a460;"></div>
                                </div>
                                <span class="text-sm">Vintage</span>
                            </div>
                        </div>
                    </div>

                    <!-- Random Generator -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Random Generator</h3>
                        <div class="space-y-3">
                            <button onclick="generateRandomPalette('vibrant')" class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                                Vibrant Colors
                            </button>
                            <button onclick="generateRandomPalette('pastel')" class="w-full px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors">
                                Pastel Colors
                            </button>
                            <button onclick="generateRandomPalette('dark')" class="w-full px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition-colors">
                                Dark Theme
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Main Palette Display -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Current Palette -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold">Current Palette</h3>
                            <div class="flex space-x-2">
                                <button onclick="savePalette()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path>
                                    </svg>
                                    Save
                                </button>
                                <button onclick="exportPalette('aco')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    Export
                                </button>
                            </div>
                        </div>
                        
                        <div id="currentPalette" class="grid grid-cols-2 md:grid-cols-5 gap-4">
                            <!-- Color swatches will be generated here -->
                        </div>

                        <!-- Color Details -->
                        <div id="colorDetails" class="mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <h4 class="font-semibold mb-3">Color Information</h4>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">HEX</label>
                                    <input id="selectedHex" type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 font-mono text-sm" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">RGB</label>
                                    <input id="selectedRgb" type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 font-mono text-sm" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">HSL</label>
                                    <input id="selectedHsl" type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 font-mono text-sm" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">CMYK</label>
                                    <input id="selectedCmyk" type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 font-mono text-sm" readonly>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Palette Variations -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Variations</h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-medium mb-2">Tints (lighter)</h4>
                                <div id="tintVariations" class="flex space-x-2"></div>
                            </div>
                            <div>
                                <h4 class="font-medium mb-2">Shades (darker)</h4>
                                <div id="shadeVariations" class="flex space-x-2"></div>
                            </div>
                            <div>
                                <h4 class="font-medium mb-2">Tones (grayed)</h4>
                                <div id="toneVariations" class="flex space-x-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Saved Palettes -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Saved Palettes</h3>
                        <div id="savedPalettes" class="space-y-3">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-4">No saved palettes yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPaletteColors = [];
        let selectedColorIndex = 0;
        let savedPalettes = JSON.parse(localStorage.getItem('colorPalettes') || '[]');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            generateFromColor(); // Generate initial palette
            loadSavedPalettes();
        });

        function setupEventListeners() {
            // Color picker events
            document.getElementById('baseColorPicker').addEventListener('change', function(e) {
                document.getElementById('baseColorHex').value = e.target.value;
                generateFromColor();
            });

            document.getElementById('baseColorHex').addEventListener('input', function(e) {
                const color = e.target.value;
                if (isValidHexColor(color)) {
                    document.getElementById('baseColorPicker').value = color;
                    generateFromColor();
                }
            });

            document.getElementById('harmonyType').addEventListener('change', generateFromColor);

            // Image upload
            const imageInput = document.getElementById('imageInput');
            const dropArea = document.getElementById('imageDropArea');

            imageInput.addEventListener('change', handleImageUpload);

            dropArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropArea.classList.add('dragover');
            });

            dropArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                dropArea.classList.remove('dragover');
            });

            dropArea.addEventListener('drop', function(e) {
                e.preventDefault();
                dropArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageFile(files[0]);
                }
            });

            dropArea.addEventListener('click', function() {
                imageInput.click();
            });
        }

        function isValidHexColor(hex) {
            return /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(hex);
        }

        function hexToHsl(hex) {
            const r = parseInt(hex.slice(1, 3), 16) / 255;
            const g = parseInt(hex.slice(3, 5), 16) / 255;
            const b = parseInt(hex.slice(5, 7), 16) / 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }

            return [Math.round(h * 360), Math.round(s * 100), Math.round(l * 100)];
        }

        function hslToHex(h, s, l) {
            h /= 360;
            s /= 100;
            l /= 100;

            const hue2rgb = (p, q, t) => {
                if (t < 0) t += 1;
                if (t > 1) t -= 1;
                if (t < 1/6) return p + (q - p) * 6 * t;
                if (t < 1/2) return q;
                if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                return p;
            };

            let r, g, b;

            if (s === 0) {
                r = g = b = l;
            } else {
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }

            const toHex = (c) => {
                const hex = Math.round(c * 255).toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            };

            return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
        }

        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return [r, g, b];
        }

        function rgbToCmyk(r, g, b) {
            const c = 1 - (r / 255);
            const m = 1 - (g / 255);
            const y = 1 - (b / 255);
            const k = Math.min(c, m, y);
            
            const cyan = Math.round(((c - k) / (1 - k)) * 100) || 0;
            const magenta = Math.round(((m - k) / (1 - k)) * 100) || 0;
            const yellow = Math.round(((y - k) / (1 - k)) * 100) || 0;
            const black = Math.round(k * 100);
            
            return [cyan, magenta, yellow, black];
        }

        function generateFromColor() {
            const baseColor = document.getElementById('baseColorHex').value;
            const harmonyType = document.getElementById('harmonyType').value;
            
            const [h, s, l] = hexToHsl(baseColor);
            let colors = [baseColor];

            switch (harmonyType) {
                case 'complementary':
                    colors = [
                        baseColor,
                        hslToHex((h + 180) % 360, s, l),
                        hslToHex(h, Math.max(s - 20, 0), Math.min(l + 20, 100)),
                        hslToHex((h + 180) % 360, Math.max(s - 20, 0), Math.min(l + 20, 100)),
                        hslToHex(h, s, Math.max(l - 30, 0))
                    ];
                    break;

                case 'triadic':
                    colors = [
                        baseColor,
                        hslToHex((h + 120) % 360, s, l),
                        hslToHex((h + 240) % 360, s, l),
                        hslToHex(h, Math.max(s - 30, 0), Math.min(l + 20, 100)),
                        hslToHex((h + 120) % 360, Math.max(s - 30, 0), Math.min(l + 20, 100))
                    ];
                    break;

                case 'analogous':
                    colors = [
                        hslToHex((h - 30 + 360) % 360, s, l),
                        hslToHex((h - 15 + 360) % 360, s, l),
                        baseColor,
                        hslToHex((h + 15) % 360, s, l),
                        hslToHex((h + 30) % 360, s, l)
                    ];
                    break;

                case 'tetradic':
                    colors = [
                        baseColor,
                        hslToHex((h + 90) % 360, s, l),
                        hslToHex((h + 180) % 360, s, l),
                        hslToHex((h + 270) % 360, s, l),
                        hslToHex(h, Math.max(s - 40, 0), Math.min(l + 30, 100))
                    ];
                    break;

                case 'monochromatic':
                    colors = [
                        hslToHex(h, s, Math.max(l - 40, 0)),
                        hslToHex(h, s, Math.max(l - 20, 0)),
                        baseColor,
                        hslToHex(h, s, Math.min(l + 20, 100)),
                        hslToHex(h, s, Math.min(l + 40, 100))
                    ];
                    break;

                case 'split-complementary':
                    colors = [
                        baseColor,
                        hslToHex((h + 150) % 360, s, l),
                        hslToHex((h + 210) % 360, s, l),
                        hslToHex(h, Math.max(s - 20, 0), Math.min(l + 20, 100)),
                        hslToHex((h + 180) % 360, Math.max(s - 40, 0), Math.min(l + 30, 100))
                    ];
                    break;
            }

            currentPaletteColors = colors;
            displayPalette(colors);
            updateColorDetails(colors[0], 0);
            generateVariations(colors[0]);
        }

        function displayPalette(colors) {
            const paletteContainer = document.getElementById('currentPalette');
            paletteContainer.innerHTML = '';

            colors.forEach((color, index) => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch aspect-square rounded-lg shadow-md relative overflow-hidden';
                swatch.style.backgroundColor = color;
                swatch.onclick = () => selectColor(color, index);

                swatch.innerHTML = `
                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-opacity flex items-end">
                        <div class="w-full p-2 text-white text-xs font-mono opacity-0 hover:opacity-100 transition-opacity" style="background: linear-gradient(transparent, rgba(0,0,0,0.7))">
                            ${color.toUpperCase()}
                        </div>
                    </div>
                `;

                paletteContainer.appendChild(swatch);
            });
        }

        function selectColor(color, index) {
            selectedColorIndex = index;
            updateColorDetails(color, index);
            generateVariations(color);
            
            // Copy to clipboard
            navigator.clipboard.writeText(color).then(() => {
                // Show brief toast or feedback
                showToast(`Color ${color} copied to clipboard!`);
            });
        }

        function updateColorDetails(color, index) {
            const [r, g, b] = hexToRgb(color);
            const [h, s, l] = hexToHsl(color);
            const [c, m, y, k] = rgbToCmyk(r, g, b);

            document.getElementById('selectedHex').value = color;
            document.getElementById('selectedRgb').value = `rgb(${r}, ${g}, ${b})`;
            document.getElementById('selectedHsl').value = `hsl(${h}, ${s}%, ${l}%)`;
            document.getElementById('selectedCmyk').value = `cmyk(${c}%, ${m}%, ${y}%, ${k}%)`;
        }

        function generateVariations(baseColor) {
            const [h, s, l] = hexToHsl(baseColor);

            // Tints (lighter)
            const tints = [];
            for (let i = 1; i <= 5; i++) {
                const newL = Math.min(l + (i * 15), 100);
                tints.push(hslToHex(h, s, newL));
            }

            // Shades (darker)
            const shades = [];
            for (let i = 1; i <= 5; i++) {
                const newL = Math.max(l - (i * 15), 0);
                shades.push(hslToHex(h, s, newL));
            }

            // Tones (grayed)
            const tones = [];
            for (let i = 1; i <= 5; i++) {
                const newS = Math.max(s - (i * 15), 0);
                tones.push(hslToHex(h, newS, l));
            }

            displayVariations('tintVariations', tints);
            displayVariations('shadeVariations', shades);
            displayVariations('toneVariations', tones);
        }

        function displayVariations(containerId, colors) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            colors.forEach(color => {
                const swatch = document.createElement('div');
                swatch.className = 'w-12 h-12 rounded cursor-pointer shadow-md hover:scale-110 transition-transform';
                swatch.style.backgroundColor = color;
                swatch.title = color;
                swatch.onclick = () => {
                    navigator.clipboard.writeText(color);
                    showToast(`${color} copied!`);
                };
                container.appendChild(swatch);
            });
        }

        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (file) {
                handleImageFile(file);
            }
        }

        function handleImageFile(file) {
            if (!file.type.startsWith('image/')) {
                showToast('Please select an image file');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                extractColorsFromImage(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        function extractColorsFromImage(imageSrc) {
            const canvas = document.getElementById('imageCanvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();

            img.onload = function() {
                canvas.width = 100;
                canvas.height = 100;
                ctx.drawImage(img, 0, 0, 100, 100);

                const imageData = ctx.getImageData(0, 0, 100, 100);
                const data = imageData.data;
                const colorCounts = {};

                // Sample pixels and count colors
                for (let i = 0; i < data.length; i += 16) { // Sample every 4th pixel
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    
                    if (data[i + 3] > 0) { // Skip transparent pixels
                        const hex = rgbToHex(r, g, b);
                        colorCounts[hex] = (colorCounts[hex] || 0) + 1;
                    }
                }

                // Get top 5 most common colors
                const sortedColors = Object.entries(colorCounts)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5)
                    .map(([color]) => color);

                currentPaletteColors = sortedColors;
                displayPalette(sortedColors);
                updateColorDetails(sortedColors[0], 0);
                generateVariations(sortedColors[0]);
            };

            img.src = imageSrc;
        }

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        function loadPresetPalette(paletteType) {
            const presets = {
                sunset: ['#ff6b6b', '#ffa726', '#ffcc02', '#ff8a65', '#d84315'],
                ocean: ['#0077be', '#00a8cc', '#40e0d0', '#87ceeb', '#b0e0e6'],
                forest: ['#2d5016', '#228b22', '#90ee90', '#9acd32', '#adff2f'],
                vintage: ['#8b4513', '#d2691e', '#daa520', '#cd853f', '#f4a460']
            };

            const colors = presets[paletteType];
            if (colors) {
                currentPaletteColors = colors;
                displayPalette(colors);
                updateColorDetails(colors[0], 0);
                generateVariations(colors[0]);
            }
        }

        function generateRandomPalette(style) {
            const colors = [];
            
            for (let i = 0; i < 5; i++) {
                let color;
                switch (style) {
                    case 'vibrant':
                        color = hslToHex(
                            Math.random() * 360,
                            60 + Math.random() * 40,
                            40 + Math.random() * 30
                        );
                        break;
                    case 'pastel':
                        color = hslToHex(
                            Math.random() * 360,
                            30 + Math.random() * 40,
                            70 + Math.random() * 25
                        );
                        break;
                    case 'dark':
                        color = hslToHex(
                            Math.random() * 360,
                            30 + Math.random() * 50,
                            10 + Math.random() * 30
                        );
                        break;
                }
                colors.push(color);
            }

            currentPaletteColors = colors;
            displayPalette(colors);
            updateColorDetails(colors[0], 0);
            generateVariations(colors[0]);
        }

        function savePalette() {
            if (currentPaletteColors.length === 0) return;

            const name = prompt('Enter a name for this palette:') || `Palette ${savedPalettes.length + 1}`;
            const palette = {
                id: Date.now(),
                name: name,
                colors: [...currentPaletteColors],
                created: new Date().toISOString()
            };

            savedPalettes.unshift(palette);
            localStorage.setItem('colorPalettes', JSON.stringify(savedPalettes));
            loadSavedPalettes();
            showToast('Palette saved!');
        }

        function loadSavedPalettes() {
            const container = document.getElementById('savedPalettes');
            
            if (savedPalettes.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4">No saved palettes yet</p>';
                return;
            }

            container.innerHTML = '';
            savedPalettes.forEach(palette => {
                const paletteDiv = document.createElement('div');
                paletteDiv.className = 'palette-card cursor-pointer hover:shadow-lg transition-shadow';
                paletteDiv.onclick = () => loadSavedPalette(palette);

                paletteDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-medium">${palette.name}</h4>
                        <button onclick="event.stopPropagation(); deletePalette('${palette.id}')" class="text-red-500 hover:text-red-700 p-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="flex space-x-1">
                        ${palette.colors.map(color => `
                            <div class="w-8 h-8 rounded" style="background-color: ${color}"></div>
                        `).join('')}
                    </div>
                    <p class="text-xs text-gray-500 mt-2">${new Date(palette.created).toLocaleDateString()}</p>
                `;

                container.appendChild(paletteDiv);
            });
        }

        function loadSavedPalette(palette) {
            currentPaletteColors = [...palette.colors];
            displayPalette(palette.colors);
            updateColorDetails(palette.colors[0], 0);
            generateVariations(palette.colors[0]);
        }

        function deletePalette(id) {
            if (confirm('Are you sure you want to delete this palette?')) {
                savedPalettes = savedPalettes.filter(p => p.id != id);
                localStorage.setItem('colorPalettes', JSON.stringify(savedPalettes));
                loadSavedPalettes();
                showToast('Palette deleted');
            }
        }

        function exportPalette(format) {
            if (currentPaletteColors.length === 0) {
                showToast('No palette to export');
                return;
            }

            let exportData = '';
            let filename = 'palette';
            let mimeType = 'text/plain';

            switch (format) {
                case 'aco':
                    // Adobe Color format (simplified)
                    exportData = currentPaletteColors.join('\n');
                    filename = 'palette.txt';
                    break;
                case 'css':
                    exportData = ':root {\n' + 
                        currentPaletteColors.map((color, i) => `  --color-${i + 1}: ${color};`).join('\n') + 
                        '\n}';
                    filename = 'palette.css';
                    mimeType = 'text/css';
                    break;
                case 'json':
                    exportData = JSON.stringify({
                        colors: currentPaletteColors,
                        exported: new Date().toISOString()
                    }, null, 2);
                    filename = 'palette.json';
                    mimeType = 'application/json';
                    break;
            }

            const blob = new Blob([exportData], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('Palette exported!');
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 right-4 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 2000);
        }
    </script>
</body>
</html>