<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Timeline Creator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .timeline-container {
            overflow-x: auto;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        .dark .timeline-container {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }
        .timeline-grid {
            min-width: 1200px;
            position: relative;
        }
        .timeline-row {
            height: 60px;
            border-bottom: 1px solid #e5e7eb;
            position: relative;
            display: flex;
            align-items: center;
        }
        .dark .timeline-row {
            border-bottom-color: #374151;
        }
        .timeline-bar {
            height: 24px;
            border-radius: 12px;
            position: absolute;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            padding: 0 12px;
            font-size: 12px;
            font-weight: 500;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        .timeline-bar:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .timeline-milestone {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            position: absolute;
            top: 22px;
            border: 3px solid;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .timeline-milestone:hover {
            transform: scale(1.2);
        }
        .timeline-header {
            height: 40px;
            border-bottom: 2px solid #d1d5db;
            background: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .dark .timeline-header {
            background: #1f2937;
            border-bottom-color: #374151;
        }
        .task-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            transition: all 0.3s ease;
        }
        .dark .task-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .progress-indicator {
            background: conic-gradient(from 0deg, #10b981 0deg, #10b981 var(--progress), #e5e7eb var(--progress), #e5e7eb 360deg);
        }
        .dark .progress-indicator {
            background: conic-gradient(from 0deg, #10b981 0deg, #10b981 var(--progress), #374151 var(--progress), #374151 360deg);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <div class="min-h-screen p-4">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <header class="text-center mb-8">
                <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                    Project Timeline Creator
                </h1>
                <p class="text-gray-600 dark:text-gray-400 mt-2">Create Gantt charts and manage project timelines</p>
            </header>

            <!-- Project Overview -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-white dark:bg-gray-800 rounded-xl p-6 text-center shadow-lg">
                    <h3 class="text-sm text-gray-500 dark:text-gray-400 uppercase tracking-wide">Total Tasks</h3>
                    <p class="text-3xl font-bold text-blue-600 dark:text-blue-400" id="totalTasks">0</p>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-xl p-6 text-center shadow-lg">
                    <h3 class="text-sm text-gray-500 dark:text-gray-400 uppercase tracking-wide">Completed</h3>
                    <p class="text-3xl font-bold text-green-600 dark:text-green-400" id="completedTasks">0</p>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-xl p-6 text-center shadow-lg">
                    <h3 class="text-sm text-gray-500 dark:text-gray-400 uppercase tracking-wide">In Progress</h3>
                    <p class="text-3xl font-bold text-yellow-600 dark:text-yellow-400" id="inProgressTasks">0</p>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-xl p-6 text-center shadow-lg">
                    <h3 class="text-sm text-gray-500 dark:text-gray-400 uppercase tracking-wide">Project Progress</h3>
                    <p class="text-3xl font-bold text-purple-600 dark:text-purple-400" id="projectProgress">0%</p>
                </div>
            </div>

            <div class="grid lg:grid-cols-4 gap-8">
                <!-- Task Management -->
                <div class="lg:col-span-1 space-y-6">
                    <!-- Add Task -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Add New Task</h3>
                        <form onsubmit="addTask(event)">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Task Name</label>
                                    <input id="taskName" type="text" required placeholder="e.g., Design wireframes" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Start Date</label>
                                    <input id="taskStartDate" type="date" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">End Date</label>
                                    <input id="taskEndDate" type="date" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Assignee</label>
                                    <input id="taskAssignee" type="text" placeholder="e.g., John Doe" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Priority</label>
                                    <select id="taskPriority" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                        <option value="critical">Critical</option>
                                    </select>
                                </div>
                                <div class="flex items-center">
                                    <input id="isMilestone" type="checkbox" class="mr-2">
                                    <label for="isMilestone" class="text-sm">Mark as milestone</label>
                                </div>
                            </div>
                            <button type="submit" class="w-full mt-4 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                Add Task
                            </button>
                        </form>
                    </div>

                    <!-- Task List -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Task List</h3>
                        <div id="taskList" class="space-y-2">
                            <!-- Tasks will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Timeline View -->
                <div class="lg:col-span-3">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold">Project Timeline</h3>
                            <div class="flex space-x-2">
                                <button onclick="exportTimeline()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    Export
                                </button>
                                <button onclick="clearAllTasks()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                    Clear All
                                </button>
                            </div>
                        </div>
                        
                        <div id="timelineContainer" class="timeline-container rounded-lg p-4">
                            <div id="timelineContent">
                                <!-- Timeline will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dependencies & Critical Path -->
            <div class="mt-8 grid md:grid-cols-2 gap-8">
                <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                    <h3 class="text-xl font-semibold mb-4">Project Statistics</h3>
                    <canvas id="statsChart" width="400" height="200"></canvas>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                    <h3 class="text-xl font-semibold mb-4">Milestones & Deadlines</h3>
                    <div id="milestonesList" class="space-y-3">
                        <!-- Milestones will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div id="editTaskModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 w-full max-w-md mx-4">
            <h3 class="text-xl font-semibold mb-4">Edit Task</h3>
            <form onsubmit="updateTask(event)">
                <input type="hidden" id="editTaskId">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Task Name</label>
                        <input id="editTaskName" type="text" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Start Date</label>
                        <input id="editTaskStartDate" type="date" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">End Date</label>
                        <input id="editTaskEndDate" type="date" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Assignee</label>
                        <input id="editTaskAssignee" type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Priority</label>
                        <select id="editTaskPriority" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Progress (%)</label>
                        <input id="editTaskProgress" type="range" min="0" max="100" value="0" class="w-full">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>0%</span>
                            <span id="progressValue">0%</span>
                            <span>100%</span>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <input id="editIsMilestone" type="checkbox" class="mr-2">
                        <label for="editIsMilestone" class="text-sm">Mark as milestone</label>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeEditTaskModal()" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Update Task
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let tasks = JSON.parse(localStorage.getItem('projectTasks') || '[]');
        let statsChart = null;

        const priorityColors = {
            low: '#10b981',
            medium: '#3b82f6',
            high: '#f59e0b',
            critical: '#ef4444'
        };

        const priorityBorders = {
            low: '#059669',
            medium: '#2563eb',
            high: '#d97706',
            critical: '#dc2626'
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            setDefaultDates();
            renderTasks();
            renderTimeline();
            updateStats();
            initStatsChart();
        });

        function setupEventListeners() {
            document.getElementById('editTaskProgress').addEventListener('input', function() {
                document.getElementById('progressValue').textContent = this.value + '%';
            });
        }

        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            const nextWeek = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            
            document.getElementById('taskStartDate').value = today;
            document.getElementById('taskEndDate').value = nextWeek;
        }

        function addTask(event) {
            event.preventDefault();
            
            const name = document.getElementById('taskName').value;
            const startDate = document.getElementById('taskStartDate').value;
            const endDate = document.getElementById('taskEndDate').value;
            const assignee = document.getElementById('taskAssignee').value;
            const priority = document.getElementById('taskPriority').value;
            const isMilestone = document.getElementById('isMilestone').checked;

            if (new Date(startDate) > new Date(endDate)) {
                alert('End date must be after start date');
                return;
            }

            const task = {
                id: Date.now().toString(),
                name: name,
                startDate: startDate,
                endDate: endDate,
                assignee: assignee || 'Unassigned',
                priority: priority,
                isMilestone: isMilestone,
                progress: 0,
                status: 'not-started',
                createdAt: new Date().toISOString()
            };

            tasks.push(task);
            localStorage.setItem('projectTasks', JSON.stringify(tasks));
            
            // Clear form
            document.getElementById('taskName').value = '';
            document.getElementById('taskAssignee').value = '';
            document.getElementById('isMilestone').checked = false;
            setDefaultDates();
            
            renderTasks();
            renderTimeline();
            updateStats();
            updateStatsChart();
        }

        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                localStorage.setItem('projectTasks', JSON.stringify(tasks));
                renderTasks();
                renderTimeline();
                updateStats();
                updateStatsChart();
            }
        }

        function openEditTaskModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            document.getElementById('editTaskId').value = taskId;
            document.getElementById('editTaskName').value = task.name;
            document.getElementById('editTaskStartDate').value = task.startDate;
            document.getElementById('editTaskEndDate').value = task.endDate;
            document.getElementById('editTaskAssignee').value = task.assignee;
            document.getElementById('editTaskPriority').value = task.priority;
            document.getElementById('editTaskProgress').value = task.progress;
            document.getElementById('progressValue').textContent = task.progress + '%';
            document.getElementById('editIsMilestone').checked = task.isMilestone;

            document.getElementById('editTaskModal').classList.remove('hidden');
            document.getElementById('editTaskModal').classList.add('flex');
        }

        function closeEditTaskModal() {
            document.getElementById('editTaskModal').classList.add('hidden');
            document.getElementById('editTaskModal').classList.remove('flex');
        }

        function updateTask(event) {
            event.preventDefault();
            
            const taskId = document.getElementById('editTaskId').value;
            const name = document.getElementById('editTaskName').value;
            const startDate = document.getElementById('editTaskStartDate').value;
            const endDate = document.getElementById('editTaskEndDate').value;
            const assignee = document.getElementById('editTaskAssignee').value;
            const priority = document.getElementById('editTaskPriority').value;
            const progress = parseInt(document.getElementById('editTaskProgress').value);
            const isMilestone = document.getElementById('editIsMilestone').checked;

            if (new Date(startDate) > new Date(endDate)) {
                alert('End date must be after start date');
                return;
            }

            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex !== -1) {
                tasks[taskIndex] = {
                    ...tasks[taskIndex],
                    name,
                    startDate,
                    endDate,
                    assignee: assignee || 'Unassigned',
                    priority,
                    progress,
                    isMilestone,
                    status: progress === 0 ? 'not-started' : progress === 100 ? 'completed' : 'in-progress'
                };
                
                localStorage.setItem('projectTasks', JSON.stringify(tasks));
                closeEditTaskModal();
                renderTasks();
                renderTimeline();
                updateStats();
                updateStatsChart();
            }
        }

        function renderTasks() {
            const container = document.getElementById('taskList');
            
            if (tasks.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4">No tasks yet</p>';
                return;
            }

            container.innerHTML = tasks.map(task => {
                const statusBadge = {
                    'not-started': 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300',
                    'in-progress': 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300',
                    'completed': 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300'
                };

                return `
                    <div class="task-card rounded-lg p-3 border border-gray-200 dark:border-gray-600">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <h4 class="font-medium text-sm">${task.name}</h4>
                                    ${task.isMilestone ? '<span class="text-xs bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300 px-2 py-1 rounded">Milestone</span>' : ''}
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                    ${task.assignee} • ${new Date(task.startDate).toLocaleDateString()} - ${new Date(task.endDate).toLocaleDateString()}
                                </div>
                                <div class="flex items-center justify-between mt-2">
                                    <span class="text-xs px-2 py-1 rounded ${statusBadge[task.status]}">${task.status.replace('-', ' ')}</span>
                                    <div class="flex items-center space-x-1">
                                        <div class="w-12 h-2 bg-gray-200 dark:bg-gray-600 rounded">
                                            <div class="h-2 bg-blue-500 rounded" style="width: ${task.progress}%"></div>
                                        </div>
                                        <span class="text-xs">${task.progress}%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex space-x-1 ml-2">
                                <button onclick="openEditTaskModal('${task.id}')" class="p-1 text-gray-400 hover:text-blue-600 transition-colors">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                </button>
                                <button onclick="deleteTask('${task.id}')" class="p-1 text-gray-400 hover:text-red-600 transition-colors">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderTimeline() {
            const container = document.getElementById('timelineContent');
            
            if (tasks.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">📅</div>
                        <h3 class="text-xl font-semibold mb-2">No timeline to display</h3>
                        <p class="text-gray-500 dark:text-gray-400">Add tasks to see your project timeline</p>
                    </div>
                `;
                return;
            }

            // Calculate date range
            const startDates = tasks.map(t => new Date(t.startDate));
            const endDates = tasks.map(t => new Date(t.endDate));
            const projectStart = new Date(Math.min(...startDates));
            const projectEnd = new Date(Math.max(...endDates));
            
            // Add padding
            projectStart.setDate(projectStart.getDate() - 3);
            projectEnd.setDate(projectEnd.getDate() + 3);
            
            const totalDays = Math.ceil((projectEnd - projectStart) / (1000 * 60 * 60 * 24));
            const dayWidth = Math.max(30, 1200 / totalDays);

            // Generate timeline header
            const timelineHeader = generateTimelineHeader(projectStart, projectEnd, dayWidth);
            
            // Generate timeline rows
            const timelineRows = tasks.map(task => {
                const taskStart = new Date(task.startDate);
                const taskEnd = new Date(task.endDate);
                const taskDuration = Math.ceil((taskEnd - taskStart) / (1000 * 60 * 60 * 24)) + 1;
                const startOffset = Math.ceil((taskStart - projectStart) / (1000 * 60 * 60 * 24));
                
                const barWidth = taskDuration * dayWidth;
                const barLeft = startOffset * dayWidth;
                
                return `
                    <div class="timeline-row">
                        <div class="w-48 px-4 flex-shrink-0 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-600">
                            <div class="text-sm font-medium truncate">${task.name}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">${task.assignee}</div>
                        </div>
                        <div class="flex-1 relative">
                            <div class="timeline-bar" 
                                 style="left: ${barLeft}px; width: ${barWidth}px; background: linear-gradient(90deg, ${priorityColors[task.priority]} 0%, ${priorityColors[task.priority]} ${task.progress}%, ${priorityColors[task.priority]}40 ${task.progress}%, ${priorityColors[task.priority]}40 100%); border: 1px solid ${priorityBorders[task.priority]};"
                                 onclick="openEditTaskModal('${task.id}')"
                                 title="${task.name} (${task.progress}% complete)">
                                <span class="truncate">${task.name}</span>
                            </div>
                            ${task.isMilestone ? `<div class="timeline-milestone" style="left: ${barLeft + barWidth - 8}px; border-color: ${priorityColors[task.priority]};" title="Milestone: ${task.name}"></div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = `
                <div class="timeline-grid">
                    ${timelineHeader}
                    ${timelineRows}
                </div>
            `;

            renderMilestones();
        }

        function generateTimelineHeader(startDate, endDate, dayWidth) {
            let headerHTML = `
                <div class="timeline-header flex">
                    <div class="w-48 px-4 flex-shrink-0 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-600 flex items-center">
                        <span class="text-sm font-medium">Task Name</span>
                    </div>
                    <div class="flex-1 relative">
            `;

            const currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                const isWeekend = currentDate.getDay() === 0 || currentDate.getDay() === 6;
                const dateStr = currentDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                headerHTML += `
                    <div style="width: ${dayWidth}px; min-width: ${dayWidth}px;" 
                         class="inline-block text-xs text-center py-2 border-r border-gray-200 dark:border-gray-600 ${isWeekend ? 'bg-gray-50 dark:bg-gray-700' : ''}">
                        ${dateStr}
                    </div>
                `;
                
                currentDate.setDate(currentDate.getDate() + 1);
            }

            headerHTML += `
                    </div>
                </div>
            `;

            return headerHTML;
        }

        function renderMilestones() {
            const container = document.getElementById('milestonesList');
            const milestones = tasks.filter(t => t.isMilestone).sort((a, b) => new Date(a.endDate) - new Date(b.endDate));

            if (milestones.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4">No milestones set</p>';
                return;
            }

            container.innerHTML = milestones.map(milestone => {
                const isOverdue = new Date(milestone.endDate) < new Date() && milestone.progress < 100;
                const daysUntil = Math.ceil((new Date(milestone.endDate) - new Date()) / (1000 * 60 * 60 * 24));
                
                return `
                    <div class="flex items-center justify-between p-3 border border-gray-200 dark:border-gray-600 rounded-lg">
                        <div>
                            <h4 class="font-medium">${milestone.name}</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Due: ${new Date(milestone.endDate).toLocaleDateString()}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-sm ${isOverdue ? 'text-red-600' : daysUntil <= 3 ? 'text-yellow-600' : 'text-gray-600'}">
                                ${isOverdue ? 'Overdue' : daysUntil === 0 ? 'Due today' : daysUntil === 1 ? 'Due tomorrow' : `${daysUntil} days`}
                            </div>
                            <div class="text-xs text-gray-500">${milestone.progress}% complete</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateStats() {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            const inProgressTasks = tasks.filter(t => t.status === 'in-progress').length;
            const projectProgress = totalTasks > 0 ? Math.round((tasks.reduce((sum, t) => sum + t.progress, 0) / totalTasks)) : 0;

            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('inProgressTasks').textContent = inProgressTasks;
            document.getElementById('projectProgress').textContent = projectProgress + '%';
        }

        function initStatsChart() {
            const ctx = document.getElementById('statsChart').getContext('2d');
            
            const priorityStats = tasks.reduce((acc, task) => {
                acc[task.priority] = (acc[task.priority] || 0) + 1;
                return acc;
            }, {});

            statsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Low', 'Medium', 'High', 'Critical'],
                    datasets: [{
                        data: [
                            priorityStats.low || 0,
                            priorityStats.medium || 0,
                            priorityStats.high || 0,
                            priorityStats.critical || 0
                        ],
                        backgroundColor: [
                            priorityColors.low,
                            priorityColors.medium,
                            priorityColors.high,
                            priorityColors.critical
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateStatsChart() {
            if (!statsChart) return;
            
            const priorityStats = tasks.reduce((acc, task) => {
                acc[task.priority] = (acc[task.priority] || 0) + 1;
                return acc;
            }, {});

            statsChart.data.datasets[0].data = [
                priorityStats.low || 0,
                priorityStats.medium || 0,
                priorityStats.high || 0,
                priorityStats.critical || 0
            ];
            
            statsChart.update();
        }

        function clearAllTasks() {
            if (confirm('Are you sure you want to clear all tasks? This action cannot be undone.')) {
                tasks = [];
                localStorage.setItem('projectTasks', JSON.stringify(tasks));
                renderTasks();
                renderTimeline();
                updateStats();
                updateStatsChart();
            }
        }

        function exportTimeline() {
            const projectData = {
                tasks: tasks,
                exported: new Date().toISOString(),
                totalTasks: tasks.length,
                completedTasks: tasks.filter(t => t.status === 'completed').length,
                projectProgress: tasks.length > 0 ? Math.round((tasks.reduce((sum, t) => sum + t.progress, 0) / tasks.length)) : 0
            };

            const dataStr = JSON.stringify(projectData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `project-timeline-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>