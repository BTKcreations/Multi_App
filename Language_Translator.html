<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Audio Translator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .pulsing {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-2xl mx-auto p-4 sm:p-6 md:p-8 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl">
        <header class="text-center mb-6">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 dark:text-white">Live Audio Translator</h1>
            <p class="text-gray-500 dark:text-gray-400 mt-2">Speak into your microphone and see the magic happen!</p>
        </header>

        <!-- Language Selection -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
                <label for="source-lang" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">From:</label>
                <select id="source-lang" class="w-full bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="en-US">English (US)</option>
                    <option value="es-ES">Spanish</option>
                    <option value="fr-FR">French</option>
                    <option value="de-DE">German</option>
                    <option value="it-IT">Italian</option>
                    <option value="ja-JP">Japanese</option>
                    <option value="ko-KR">Korean</option>
                    <option value="ru-RU">Russian</option>
                    <option value="hi-IN">Hindi</option>
                </select>
            </div>
            <div>
                <label for="target-lang" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">To:</label>
                <select id="target-lang" class="w-full bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="en">English</option>
                    <option value="it">Italian</option>
                    <option value="ja">Japanese</option>
                    <option value="ko">Korean</option>
                    <option value="ru">Russian</option>
                     <option value="hi">Hindi</option>
                </select>
            </div>
        </div>

        <!-- Action Button -->
        <div class="text-center mb-6">
            <button id="start-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>
                Start Translating
            </button>
            <button id="stop-btn" class="hidden bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                <svg class="inline-block w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"></path></svg>
                Stop Translating
            </button>
        </div>

        <!-- Status & Output -->
        <div id="status" class="text-center text-gray-500 dark:text-gray-400 mb-4 h-6"></div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg shadow-inner">
                <h2 class="text-lg font-semibold mb-2 text-gray-800 dark:text-white">You said:</h2>
                <p id="source-text" class="text-gray-600 dark:text-gray-300 min-h-[50px]"></p>
            </div>
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg shadow-inner">
                <h2 class="text-lg font-semibold mb-2 text-gray-800 dark:text-white">Translation:</h2>
                <p id="translated-text" class="text-gray-600 dark:text-gray-300 min-h-[50px]"></p>
            </div>
        </div>
         <!-- Message Box -->
        <div id="message-box" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center">
            <div class="bg-white dark:bg-gray-800 p-5 rounded-lg shadow-xl text-center">
                <h3 class="text-lg font-bold mb-4" id="message-title"></h3>
                <p id="message-content"></p>
                <button id="message-ok-btn" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">OK</button>
            </div>
        </div>
    </div>

    <script>
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const sourceLangSelect = document.getElementById('source-lang');
        const targetLangSelect = document.getElementById('target-lang');
        const sourceTextElem = document.getElementById('source-text');
        const translatedTextElem = document.getElementById('translated-text');
        const statusElem = document.getElementById('status');
        const messageBox = document.getElementById('message-box');
        const messageTitle = document.getElementById('message-title');
        const messageContent = document.getElementById('message-content');
        const messageOkBtn = document.getElementById('message-ok-btn');


        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;

        function showMessage(title, content) {
            messageTitle.textContent = title;
            messageContent.textContent = content;
            messageBox.classList.remove('hidden');
        }

        messageOkBtn.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });


        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onstart = () => {
                statusElem.textContent = "Listening... Speak into your microphone.";
                statusElem.classList.add('pulsing');
                startBtn.classList.add('hidden');
                stopBtn.classList.remove('hidden');
            };

            recognition.onend = () => {
                statusElem.textContent = "Press 'Start Translating' to begin.";
                statusElem.classList.remove('pulsing');
                startBtn.classList.remove('hidden');
                stopBtn.classList.add('hidden');
            };

            recognition.onerror = (event) => {
                let errorMessage = 'An error occurred with speech recognition.';
                if (event.error === 'not-allowed' || event.error === 'service-not-allowed') {
                    errorMessage = "Microphone access denied. Please allow microphone access in your browser settings.";
                } else if (event.error === 'no-speech') {
                    errorMessage = "No speech was detected. Please try again.";
                }
                showMessage('Error', errorMessage);
                console.error('Speech recognition error:', event.error);
                statusElem.textContent = `Error: ${event.error}`;
                statusElem.classList.remove('pulsing');
            };

            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }

                sourceTextElem.textContent = finalTranscript + interimTranscript;

                if (finalTranscript) {
                    translateText(finalTranscript.trim());
                }
            };

        } else {
            showMessage('Compatibility Error', 'Speech Recognition API is not supported in this browser. Please try Chrome or Edge.');
            startBtn.disabled = true;
            startBtn.textContent = 'Not Supported';
        }

        startBtn.addEventListener('click', async () => {
            try {
                // Request microphone permission
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                // We don't need to do anything with the stream directly,
                // but this call ensures we have permission before starting recognition.
                stream.getTracks().forEach(track => track.stop()); // Stop the track immediately after getting permission

                if (recognition) {
                    recognition.lang = sourceLangSelect.value;
                    recognition.start();
                }
            } catch (err) {
                 if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                    showMessage('Permission Denied', 'Microphone access was denied. You need to allow it to use this feature.');
                } else {
                    showMessage('Error', `Could not access microphone: ${err.message}`);
                }
                console.error('Could not get media stream:', err);
            }
        });

        stopBtn.addEventListener('click', () => {
            if (recognition) {
                recognition.stop();
            }
        });

        // --- Placeholder Translation Function ---
        // In a real application, you would replace this with a call to a translation API
        // like Google Translate, DeepL, or Microsoft Translator.
        function translateText(text) {
            const targetLang = targetLangSelect.value;
            statusElem.textContent = "Translating...";

            // This is a mock translation.
            const mockTranslations = {
                "es": "¡Hola Mundo!",
                "fr": "Bonjour le monde!",
                "de": "Hallo Welt!",
                "en": "Hello World!",
                "it": "Ciao mondo!",
                "ja": "こんにちは世界！",
                "ko": "안녕하세요 세계!",
                "ru": "Привет, мир!",
                "hi": "नमस्ते दुनिया!",
            };

            // Simulate network delay
            setTimeout(() => {
                const translated = `[${targetLang.toUpperCase()}] ${text}`; // Simple mock
                const mockTranslation = mockTranslations[targetLang] || "Translation not available.";

                // A more "realistic" mock based on the input text
                translatedTextElem.textContent = `"${text}" in ${targetLang.toUpperCase()} is mocked as: "${mockTranslation}"`;
                statusElem.textContent = "Listening...";
            }, 500);
        }

    </script>
</body>
</html>
